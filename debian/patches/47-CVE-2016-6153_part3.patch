Index: sqlite3/src/os_unix.c
==================================================================
--- sqlite3/src/os_unix.c
+++ sqlite3/src/os_unix.c
@@ -5412,19 +5412,23 @@ static const char *unixTempFileDir(void)
      "/tmp",
      0        /* List terminator */
   };
-  unsigned int i;
+  unsigned int i = 0;
   struct stat buf;
   const char *zDir = 0;
 
   azDirs[0] = sqlite3_temp_directory;
   if( !azDirs[1] ) azDirs[1] = getenv("SQLITE_TMPDIR");
   if( !azDirs[2] ) azDirs[2] = getenv("TMPDIR");
-  for(i=0; i<=sizeof(azDirs)/sizeof(azDirs[0]); zDir=azDirs[i++]){
-    if( zDir==0 ) continue;
-    if( osStat(zDir, &buf) ) continue;
-    if( !S_ISDIR(buf.st_mode) ) continue;
-    if( osAccess(zDir, 03) ) continue;
-    return zDir;
+  while(1){
+    if( zDir!=0
+     && osStat(zDir, &buf)==0
+     && S_ISDIR(buf.st_mode)
+     && osAccess(zDir, 03)==0
+    ){
+      return zDir;
+    }
+    if( i>=sizeof(azDirs)/sizeof(azDirs[0]) ) break;
+    zDir = azDirs[i++];
   }
   return 0;
 }
