From: Markus Koschany <apo@debian.org>
Date: Thu, 10 Jan 2019 12:19:19 +0100
Subject: CVE-2017-2520

Origin: https://www.sqlite.org/src/info/2dc7eeb5b4d2eaf1
---
 src/vdbemem.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/vdbemem.c b/src/vdbemem.c
index 870fb5b..17ca3ab 100644
--- a/src/vdbemem.c
+++ b/src/vdbemem.c
@@ -1008,6 +1008,7 @@ static SQLITE_NOINLINE const void *valueToText(sqlite3_value* pVal, u8 enc){
   assert( (pVal->flags & MEM_RowSet)==0 );
   assert( (pVal->flags & (MEM_Null))==0 );
   if( pVal->flags & (MEM_Blob|MEM_Str) ){
+    if( ExpandBlob(pVal) ) return 0;
     pVal->flags |= MEM_Str;
     if( pVal->flags & MEM_Zero ){
       sqlite3VdbeMemExpandBlob(pVal);
